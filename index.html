    	
    	
    	
    	<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Live Stream Client</title>

    <style>
        body {
            font-family: georgia;
            background: linear-gradient(to right, teal, maroon);
            border: 1px solid orange;
            border-radius: 4px;
            margin-top: 1px;
            color: orange;
            text-align: center;
            padding: 2px;
        }

        footer, h1 {
            border: 1px solid orange;
            border-radius: 4px;
            background: teal;
            margin: 2px;
            padding: 10px;
            color: orange;
        }

        h2 {
            border: 1px solid orange;
            border-radius: 6px;
            background: maroon;
            margin: 20px;
            font-size: 14px;
            padding: 8px;
            color: orange;
            text-align: center;
        }

        .container {
            max-width: 1100px;
            margin: auto;
        }

        header {
            margin-bottom: 20px;
        }

        /* GRID LAYOUT */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* WHITE CARDS */
        .card {
        	background: linear-gradient(to right, maroon, teal);
            backgroud: white;
            padding: 2px;
            border-radius: 14px;
            box-shadow: 0px 4px 14px rgba(0,0,0,0.2);
            color: black;
            text-align: left;
            border:1px solid orange;
        }

        /* VIDEO CONTAINER */
        .video-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
        }

        .video-feed {
            width: 100%;
            height: 100%;
            background-color: #1f2937;
            border-radius: 10px;
            object-fit: cover;
            transform: scaleX(-1);
        }

        #remoteVideo {
            transform: scaleX(1);
        }

        /* BUTTONS */
        button {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            color: white;
            font-weight: bold;
        }

        .btn-green {
        background: teal;
        color:orange;
         }
         
        .btn-red {
        	 background: maroon;
        	 color:orange;
        	  }
        
        .btn-blue {
        	 background: orange;
        	 color:gray;
        	  }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* FLEX SPACING */
        .flex-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* REMOTE OVERLAY */
        #remoteStatus {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* CONSOLE BOX */
        #statusConsole {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 12px;
            height: 140px;
            overflow-y: scroll;
            font-size: 14px;
            border: 1px solid orange;
            color: teal;
        }
    </style>
</head>

<body>
<div class="container">

    <header>
        <h1>Full Stack Live Stream</h1>
        <p id="userIdDisplay" style="color:white;">Your ID: Connecting...</p>
        <p id="broadcasterStatus" style="color:yellow;">Status: Waiting for Broadcaster.</p>
        <p style="font-size:12px; margin-top:5px; color:lightcoral;">Note: P2P simulated connections.</p>
    </header>

    <div class="grid">

        <!-- LOCAL STREAM -->
        <div class="card">
            <h2>Your Camera</h2>

            <div class="video-container">
                <video id="localVideo" class="video-feed" autoplay playsinline muted></video>
            </div>

            <div class="flex-row">
                <button id="startStreamBtn" onclick="startLocalStream(true)" class="btn-green">
                    <span id="startText">Start Broadcast</span>
                </button>

                <button id="stopStreamBtn" onclick="stopLocalStream()" class="btn-red" disabled>
                    Stop Broadcast
                </button>
            </div>

            <div class="flex-between" style="margin-top:15px;">
                <label>
                    <input type="checkbox" id="frontCameraToggle" checked>
                    <span style="margin-left:5px;">Use Front Camera</span>
                </label>

                <button id="connectBtn" onclick="requestConnectAsViewer()" class="btn-blue" disabled>
                    Connect as Viewer
                </button>
            </div>
        </div>

        <!-- REMOTE STREAM -->
        <div class="card">
            <h2>Remote Broadcast Feed</h2>

            <div class="video-container">
                <video id="remoteVideo" class="video-feed" autoplay playsinline></video>

                <p id="remoteStatus">Awaiting Stream...</p>
            </div>
        </div>
    </div><br>
    
    <button onclick="toggleBroadcasterList()">Show Broadcasters ▼</button>

<div id="broadcasterList" style="display:none; background:white; color:black; padding:10px; margin:10px; border-radius:6px; border:1px solid orange;">
    Loading…
</div>

    <!-- SYSTEM CONSOLE -->
    <div class="card" style="margin-top:20px;">
        <h3 style="margin-bottom:10px; text-align:center; color:teal;">System Console</h3>
        <div id="statusConsole"></div>
    </div>

</div>

<footer style="font-size:10px;">&copy; 2025 Copyright SM Technology Live Streaming</footer>

<script>
// (YOUR EXISTING JAVASCRIPT — Unchanged)
// =========================================================
// FIXED VERSION
// =========================================================
const WS_URL =
    (window.location.protocol === "https:" ? "wss://" : "ws://") +
    window.location.host;

let ws = null;
let pc = null;
let localStream = null;
let userId = null;
let username = null;
let activeBroadcasterId = null;
let activeBroadcasterName = null;
let broadcasters = []; // list of all broadcasters

const localVideo = document.getElementById("localVideo");
const remoteVideo = document.getElementById("remoteVideo");
const remoteStatus = document.getElementById("remoteStatus");
const consoleEl = document.getElementById("statusConsole");

const startBtn = document.getElementById("startStreamBtn");
const stopBtn = document.getElementById("stopStreamBtn");
const connectBtn = document.getElementById("connectBtn");

const cameraToggle = document.getElementById("frontCameraToggle");
const userIdDisplay = document.getElementById("userIdDisplay");
const broadcasterStatus = document.getElementById("broadcasterStatus");

const PEER_CONFIG = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

function log(msg) {
    const p = document.createElement("p");
    p.textContent = msg;
    consoleEl.appendChild(p);
    consoleEl.scrollTop = consoleEl.scrollHeight;
}

function connectSignalingServer() {
    ws = new WebSocket(WS_URL);

    ws.onopen = () => log("Connected to server.");

    ws.onmessage = handleSignalMessage;

    ws.onclose = () => {
        log("Disconnected—Reconnecting…");
        setTimeout(connectSignalingServer, 1500);
    };
}

function send(msg) {
    if (ws.readyState === WebSocket.OPEN) ws.send(JSON.stringify(msg));
}

function handleSignalMessage(event) {
    const data = JSON.parse(event.data);

    // Receive assigned user ID
    if (data.type === "id") {
        userId = data.id;

        // Send real chosen name to server
        username = prompt("Enter your Display Name:", "User") || "User";

        send({ type: "set_name", name: username });

        userIdDisplay.textContent = "Logged in as: " + username;
        return;
    }

    // Receive list of all broadcasters
    if (data.type === "broadcaster_list") {
        broadcasters = data.list;
        updateBroadcasterList();
        return;
    }

    // A broadcaster starts
    if (data.type === "broadcaster_started") {
        activeBroadcasterId = data.broadcasterId;
        activeBroadcasterName = data.broadcasterName;

        broadcasterStatus.textContent =
            "Broadcaster Online: " + activeBroadcasterName;

        connectBtn.disabled = false;
        return;
    }

    // Broadcaster ends
    if (data.type === "broadcaster_ended") {
        activeBroadcasterId = null;
        activeBroadcasterName = null;

        broadcasterStatus.textContent = "No active broadcaster.";
        connectBtn.disabled = true;

        remoteVideo.srcObject = null;
        remoteStatus.textContent = "Awaiting Stream...";
        return;
    }

    // Viewer → broadcaster request
    if (data.type === "request_offer") {
        if (isBroadcasting) {
            createOffer(data.viewerId);
        }
        return;
    }

    // Broadcaster → viewer
    if (data.type === "offer") {
        startLocalStream(false).then(() => createAnswer(data.sdp, data.senderId));
        return;
    }

    // Viewer → broadcaster
    if (data.type === "answer") {
        pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
        return;
    }

    // ICE candidates
    if (data.type === "candidate") {
        if (pc) pc.addIceCandidate(new RTCIceCandidate(data.candidate));
    }
}

async function startLocalStream(isBroadcaster = false) {
    startBtn.disabled = true;
    stopBtn.disabled = false;

    const constraints = {
        video: { facingMode: cameraToggle.checked ? "user" : "environment" },
        audio: true,
    };

    localStream = await navigator.mediaDevices.getUserMedia(constraints);
    localVideo.srcObject = localStream;

    isBroadcasting = isBroadcaster;

    if (isBroadcaster) {
        send({ type: "start_broadcast", name: username });
        broadcasterStatus.textContent = "YOU ARE BROADCASTING";
    }

    initPeerConnection();
}

function stopLocalStream() {
    stopBtn.disabled = true;
    startBtn.disabled = false;

    if (localStream) {
        localStream.getTracks().forEach(t => t.stop());
    }

    if (isBroadcasting) {
        send({ type: "stop_broadcast" });
    }

    stopPeerConnection();
    remoteVideo.srcObject = null;
    remoteStatus.textContent = "Awaiting Stream...";

    isBroadcasting = false;
}

function initPeerConnection() {
    pc = new RTCPeerConnection(PEER_CONFIG);

    if (localStream) {
        localStream.getTracks().forEach(t => pc.addTrack(t, localStream));
    }

    pc.ontrack = (event) => {
        remoteVideo.srcObject = event.streams[0];
        remoteStatus.textContent = "";
    };

    pc.onicecandidate = (event) => {
        if (event.candidate) {
            send({
                type: "candidate",
                candidate: event.candidate,
                targetId: pc.targetId
            });
        }
    };
}

function stopPeerConnection() {
    if (pc) pc.close();
    pc = null;
}

async function createOffer(viewerId) {
    pc.targetId = viewerId;

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    send({
        type: "offer",
        sdp: offer,
        targetId: viewerId
    });
}

async function createAnswer(offer, broadcasterId) {
    pc.targetId = broadcasterId;

    await pc.setRemoteDescription(new RTCSessionDescription(offer));
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);

    send({
        type: "answer",
        sdp: answer,
        targetId: broadcasterId
    });
}

function requestConnectAsViewer() {
    send({ type: "request_offer", viewerId: userId });
}

// DROPDOWN FUNCTIONALITY
function toggleBroadcasterList() {
    const box = document.getElementById("broadcasterList");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

function updateBroadcasterList() {
    const box = document.getElementById("broadcasterList");
    box.innerHTML = "<h4>Available Broadcasters:</h4>";

    if (broadcasters.length === 0) {
        box.innerHTML += "<p>No broadcasters online.</p>";
        return;
    }

    broadcasters.forEach(b => {
        box.innerHTML += `<p>• ${b.name}</p>`;
    });
}

// INIT
connectSignalingServer();
</script>
</body>
</html>